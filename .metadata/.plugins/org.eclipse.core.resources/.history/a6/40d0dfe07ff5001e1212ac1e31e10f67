<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>    
<%@ page import="java.sql.*" %>
<%@ page import="java.util.*" %>
<%@ page import="com.jspstudy.ch06_1.vo.*" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<% 
 	String user = "scott";
 	String pass = "tiger";
 	String driver = "oracle.jdbc.driver.OracleDriver";
 	String url = "jdbc:orcle:thin:@localhost:1521:xe";
 
 	// 1. ì ‘ì† ë“œë¼ì´ë²„ ë¡œë”©
 	Class.forName(driver);
 	
 	// 2. DBì— ì—°ê²°
	Connection conn = DriverManager.getConnection(url, user, pass);
 	
 	// 3. DBì— SQLì„ ë°œí–‰í•´ì£¼ëŠ” ê°ì²´
 	PreparedStatement pstmt = conn.prepareStatement("select * from jspbbs order by no DESC");
 	
 	// 4. DBì— ì¿¼ë¦¬ë¥¼ ë°œí–‰í•˜ê³  í…Œì´ë¸”ì—ì„œ ì¡°íšŒí•œ ê²°ê³¼ ì§‘í•©ì„ ë°›ëŠ”ë‹¤.
 	ResultSet rs = pstmt.executeQuery();
 	List<Board> bList = new ArrayList<>();
 	
 	while(rs.next()){
 		// í•œ í–‰ì”© ë°ì´í„°ë¥¼ ì¶”ì¶œí•´ì„œ Board ê°ì²´ ë‹´ê³  Listì— ë‹´ëŠ”ë‹¤.
 		Board b = new Board();
 		b.setNo(rs.getInt("no"));
 		b.setTitle(rs.getString("title"));
 		b.setWriter(rs.getString("writer"));
 		b.setContent(rs.getString("content"));
 		b.setRegDate(rs.getTimestamp("reg_date"));
 		b.setReadCount(rs.getInt("read_count"));
 		b.setFile1(rs.getString("file1"));
 		
 		bList.add(b);
 		
 	}
 	
 	// DB ì‘ì—…ì— ì‚¬ìš©í•œ ìì›ì„ í•´ì œ - ì•ì—ì„œ ê°€ì ¸ì˜¨ ì—­ìˆœìœ¼ë¡œ ë‹«ëŠ”ë‹¤.
 	if(rs != null) rs.close();
 	if(pstmt != null) pstmt.close();
 	if(conn != null) conn.close();
 	
	request.getRequestDispatcher("dbConnection.jsp");
 	
%>
   
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ê²Œì‹œíŒ</title>
<style>
	table{
		border: 1px solid blue;
		border-collapse:collapse;
	}
	td{
		border: 1px dotted blue;
		padding: 5px 10px;
	}
</style>
</head>
<body>
	<h1>ğŸ¦‹ ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ ğŸ¦‹</h1>
	<table>
		<tr>
			<th>NO</th>
			<th>TITLE</th>
			<th>WRITER</th>
			<th>REG_DATE</th>
			<th>READ_COUNT</th>
		</tr>
		
		<c:forEach var="board" items="<%= bList %>">
			<tr>
				<td>${ board.no }</td>
				<td>${ board.title }</td>
				<td>${ board.writer }</td>
				<td>${ board.regDate }</td>
				<td>${ board.readCount }</td>
			</tr>
		</c:forEach>	
	</table>
</body>
</html>